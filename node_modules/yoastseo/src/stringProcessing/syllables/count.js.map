{"version":3,"sources":["../../../../src/stringProcessing/syllables/count.js"],"names":["countVowelGroups","word","locale","numberOfSyllables","vowelRegex","RegExp","vowels","foundVowels","split","filteredWords","vowel","length","countVowelDeviations","syllableCountIterator","SyllableCountIterator","countSyllables","countFullWordDeviations","fullWordDeviations","deviations","words","full","deviation","fullWordDeviation","syllables","createDeviationFragments","syllableConfig","deviationFragments","fragments","fragmentLocation","fragment","location","DeviationFragment","createDeviationFragmentsMemoized","countPartialWordDeviations","remainingParts","syllableCount","deviationFragment","occursIn","removeFrom","getSyllables","countUsingVowels","countSyllablesInWord","fullWordExclusion","partialExclusions","countSyllablesInText","text","toLocaleLowerCase","syllableCounts"],"mappings":"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","file":"count.js","sourcesContent":["/** @module stringProcessing/countSyllables */\n\nimport syllableMatchers from \"../../config/syllables.js\";\n\nimport getWords from \"../getWords.js\";\n\nimport { forEach } from \"lodash-es\";\nimport { filter } from \"lodash-es\";\nimport { find } from \"lodash-es\";\nimport { isUndefined } from \"lodash-es\";\nimport { map } from \"lodash-es\";\nimport { sum } from \"lodash-es\";\nimport { memoize } from \"lodash-es\";\nimport { flatMap } from \"lodash-es\";\n\nimport SyllableCountIterator from \"../../helpers/syllableCountIterator.js\";\nimport DeviationFragment from \"./DeviationFragment\";\n\n/**\n * Counts vowel groups inside a word.\n *\n * @param {string} word A text with words to count syllables.\n * @param {String} locale The locale to use for counting syllables.\n * @returns {number} the syllable count.\n */\nvar countVowelGroups = function( word, locale ) {\n\tvar numberOfSyllables = 0;\n\tvar vowelRegex = new RegExp( \"[^\" + syllableMatchers( locale ).vowels + \"]\", \"ig\" );\n\tvar foundVowels = word.split( vowelRegex );\n\tvar filteredWords = filter( foundVowels, function( vowel ) {\n\t\treturn vowel !== \"\";\n\t} );\n\tnumberOfSyllables += filteredWords.length;\n\n\treturn numberOfSyllables;\n};\n\n/**\n * Counts the syllables using vowel exclusions. These are used for groups of vowels that are more or less\n * than 1 syllable.\n *\n * @param {String} word The word to count syllables of.\n * @param {String} locale The locale to use for counting syllables.\n * @returns {number} The number of syllables found in the given word.\n */\nvar countVowelDeviations = function( word, locale ) {\n\tvar syllableCountIterator = new SyllableCountIterator( syllableMatchers( locale ) );\n\treturn syllableCountIterator.countSyllables( word );\n};\n\n/**\n * Returns the number of syllables for the word if it is in the list of full word deviations.\n *\n * @param {String} word The word to retrieve the syllables for.\n * @param {String} locale The locale to use for counting syllables.\n * @returns {number} The number of syllables found.\n */\nvar countFullWordDeviations = function( word, locale ) {\n\tvar fullWordDeviations = syllableMatchers( locale ).deviations.words.full;\n\n\tvar deviation = find( fullWordDeviations, function( fullWordDeviation ) {\n\t\treturn fullWordDeviation.word === word;\n\t} );\n\n\tif ( ! isUndefined( deviation ) ) {\n\t\treturn deviation.syllables;\n\t}\n\n\treturn 0;\n};\n\n/**\n * Creates an array of deviation fragments for a certain locale.\n *\n * @param {Object} syllableConfig Syllable config for a certain locale.\n * @returns {DeviationFragment[]} A list of deviation fragments\n */\nfunction createDeviationFragments( syllableConfig ) {\n\tvar deviationFragments = [];\n\n\tvar deviations = syllableConfig.deviations;\n\n\tif ( ! isUndefined( deviations.words ) && ! isUndefined( deviations.words.fragments ) ) {\n\t\tdeviationFragments = flatMap( deviations.words.fragments, function( fragments, fragmentLocation ) {\n\t\t\treturn map( fragments, function( fragment ) {\n\t\t\t\tfragment.location = fragmentLocation;\n\n\t\t\t\treturn new DeviationFragment( fragment );\n\t\t\t} );\n\t\t} );\n\t}\n\n\treturn deviationFragments;\n}\n\nvar createDeviationFragmentsMemoized = memoize( createDeviationFragments );\n\n/**\n * Counts syllables in partial exclusions. If these are found, returns the number of syllables  found, and the modified word.\n * The word is modified so the excluded part isn't counted by the normal syllable counter.\n *\n * @param {String} word The word to count syllables of.\n * @param {String} locale The locale to use for counting syllables.\n * @returns {object} The number of syllables found and the modified word.\n */\nvar countPartialWordDeviations = function( word, locale ) {\n\tvar deviationFragments = createDeviationFragmentsMemoized( syllableMatchers( locale ) );\n\tvar remainingParts = word;\n\tvar syllableCount = 0;\n\n\tforEach( deviationFragments, function( deviationFragment ) {\n\t\tif ( deviationFragment.occursIn( remainingParts ) ) {\n\t\t\tremainingParts = deviationFragment.removeFrom( remainingParts );\n\t\t\tsyllableCount += deviationFragment.getSyllables();\n\t\t}\n\t} );\n\n\treturn { word: remainingParts, syllableCount: syllableCount };\n};\n\n/**\n * Count the number of syllables in a word, using vowels and exceptions.\n *\n * @param {String} word The word to count the number of syllables of.\n * @param {String} locale The locale to use for counting syllables.\n * @returns {number} The number of syllables found in a word.\n */\nvar countUsingVowels = function( word, locale ) {\n\tvar syllableCount = 0;\n\n\tsyllableCount += countVowelGroups( word, locale );\n\tsyllableCount += countVowelDeviations( word, locale );\n\n\treturn syllableCount;\n};\n\n/**\n * Counts the number of syllables in a word.\n *\n * @param {string} word The word to count syllables of.\n * @param {string} locale The locale of the word.\n * @returns {number} The syllable count for the word.\n */\nvar countSyllablesInWord = function( word, locale ) {\n\tvar syllableCount = 0;\n\n\tvar fullWordExclusion = countFullWordDeviations( word, locale );\n\tif ( fullWordExclusion !== 0 ) {\n\t\treturn fullWordExclusion;\n\t}\n\n\tvar partialExclusions = countPartialWordDeviations( word, locale );\n\tword = partialExclusions.word;\n\tsyllableCount += partialExclusions.syllableCount;\n\tsyllableCount += countUsingVowels( word, locale );\n\n\treturn syllableCount;\n};\n\n/**\n * Counts the number of syllables in a text per word based on vowels.\n * Uses exclusion words for words that cannot be matched with vowel matching.\n *\n * @param {String} text The text to count the syllables of.\n * @param {String} locale The locale to use for counting syllables.\n * @returns {int} The total number of syllables found in the text.\n */\nvar countSyllablesInText = function( text, locale ) {\n\ttext = text.toLocaleLowerCase();\n\tvar words = getWords( text );\n\n\tvar syllableCounts = map( words,  function( word ) {\n\t\treturn countSyllablesInWord( word, locale );\n\t} );\n\n\treturn sum( syllableCounts );\n};\n\nexport default countSyllablesInText;\n"]}