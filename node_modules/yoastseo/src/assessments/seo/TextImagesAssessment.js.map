{"version":3,"sources":["../../../../src/assessments/seo/TextImagesAssessment.js"],"names":["TextImagesAssessment","Assessment","constructor","config","defaultConfig","parameters","lowerBoundary","upperBoundary","scores","noImages","withAltGoodNumberOfKeywordMatches","withAltTooFewKeywordMatches","withAltTooManyKeywordMatches","withAltNonKeyword","withAlt","noAlt","urlTitle","urlCallToAction","identifier","_config","getResult","paper","researcher","i18n","imageCount","getResearch","altProperties","_minNumberOfKeywordMatches","Math","ceil","_maxNumberOfKeywordMatches","floor","calculatedScore","calculateResult","assessmentResult","AssessmentResult","setScore","score","setText","resultText","isApplicable","hasText","hasTooFewMatches","withAltKeyword","hasGoodNumberOfMatches","hasTooManyMatches","sprintf","dgettext","dngettext"],"mappings":"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","file":"TextImagesAssessment.js","sourcesContent":["import { merge } from \"lodash-es\";\n\nimport Assessment from \"../../assessment\";\nimport { inRangeStartEndInclusive } from \"../../helpers/inRange.js\";\nimport { createAnchorOpeningTag } from \"../../helpers/shortlinker\";\nimport AssessmentResult from \"../../values/AssessmentResult\";\n\n/**\n * Represents the assessment that will look if the images have alt-tags and checks if the keyword is present in one of them.\n */\nexport default class TextImagesAssessment extends Assessment {\n\t/**\n\t * Sets the identifier and the config.\n\t *\n\t * @param {object} config The configuration to use.\n\t *\n\t * @returns {void}\n\t */\n\tconstructor( config = {} ) {\n\t\tsuper();\n\n\t\tconst defaultConfig = {\n\t\t\tparameters: {\n\t\t\t\tlowerBoundary: 0.3,\n\t\t\t\tupperBoundary: 0.75,\n\t\t\t},\n\t\t\tscores: {\n\t\t\t\tnoImages: 3,\n\t\t\t\twithAltGoodNumberOfKeywordMatches: 9,\n\t\t\t\twithAltTooFewKeywordMatches: 6,\n\t\t\t\twithAltTooManyKeywordMatches: 6,\n\t\t\t\twithAltNonKeyword: 6,\n\t\t\t\twithAlt: 6,\n\t\t\t\tnoAlt: 6,\n\t\t\t},\n\t\t\turlTitle: createAnchorOpeningTag( \"https://yoa.st/33c\" ),\n\t\t\turlCallToAction: createAnchorOpeningTag( \"https://yoa.st/33d\" ),\n\t\t};\n\n\t\tthis.identifier = \"textImages\";\n\t\tthis._config = merge( defaultConfig, config );\n\t}\n\n\t/**\n\t * Execute the Assessment and return a result.\n\t *\n\t * @param {Paper} paper The Paper object to assess.\n\t * @param {Researcher} researcher The Researcher object containing all available researches.\n\t * @param {Jed} i18n The locale object.\n\t *\n\t * @returns {AssessmentResult} The result of the assessment, containing both a score and a descriptive text.\n\t */\n\tgetResult( paper, researcher, i18n ) {\n\t\tthis.imageCount = researcher.getResearch( \"imageCount\" );\n\t\tthis.altProperties = researcher.getResearch( \"altTagCount\" );\n\n\t\tthis._minNumberOfKeywordMatches = Math.ceil( this.imageCount * this._config.parameters.lowerBoundary );\n\t\tthis._maxNumberOfKeywordMatches = Math.floor( this.imageCount * this._config.parameters.upperBoundary );\n\n\t\tconst calculatedScore = this.calculateResult( i18n );\n\n\t\tconst assessmentResult = new AssessmentResult();\n\t\tassessmentResult.setScore( calculatedScore.score );\n\t\tassessmentResult.setText( calculatedScore.resultText );\n\n\t\treturn assessmentResult;\n\t}\n\n\t/**\n\t * Checks whether the paper has text.\n\t *\n\t * @param {Paper} paper The paper to use for the assessment.\n\t *\n\t * @returns {boolean} True when there is text.\n\t */\n\tisApplicable( paper ) {\n\t\treturn paper.hasText();\n\t}\n\n\t/**\n\t * Checks whether there are too few alt tags with keywords. This check is applicable when there are\n\t * 5 or more images.\n\t *\n\t * @returns {boolean} Returns true if there are at least 5 images and the number of alt tags\n\t * with keywords is under the specified recommended minimum.\n\t */\n\thasTooFewMatches() {\n\t\treturn this.imageCount > 4 && this.altProperties.withAltKeyword > 0 &&\n\t\t\tthis.altProperties.withAltKeyword < this._minNumberOfKeywordMatches;\n\t}\n\n\t/**\n\t * Checks whether there is a sufficient number of alt tags with keywords. There are different recommended\n\t * ranges for less than 5 keywords, exactly 5 keywords, and more than 5 keywords.\n\t *\n\t * @returns {boolean} Returns true if the number of alt tags with keywords is within the recommended range.\n\t */\n\thasGoodNumberOfMatches() {\n\t\treturn ( ( this.imageCount < 5 && this.altProperties.withAltKeyword > 0 ) ||\n\t\t\t( this.imageCount === 5 && inRangeStartEndInclusive( this.altProperties.withAltKeyword, 2, 4 ) ) ||\n\t\t\t( this.imageCount > 4 &&\n\t\t\t\tinRangeStartEndInclusive( this.altProperties.withAltKeyword, this._minNumberOfKeywordMatches, this._maxNumberOfKeywordMatches ) ) );\n\t}\n\n\t/**\n\t * Checks whether there is a sufficient number of alt tags with keywords. This check is applicable when there are\n\t * 5 or more images.\n\t *\n\t * @returns {boolean} Returns true if there are at least 5 images and the number of alt tags with keywords\n\t * is within the recommended range.\n\t */\n\thasTooManyMatches() {\n\t\treturn this.imageCount > 4 && this.altProperties.withAltKeyword > this._maxNumberOfKeywordMatches;\n\t}\n\n\n\t/**\n\t * Calculate the result based on the current image count and current image alt-tag count.\n\t *\n\t * @param {Object} i18n The object used for translations.\n\t *\n\t * @returns {Object} The calculated result.\n\t */\n\tcalculateResult( i18n ) {\n\t\t// No images.\n\t\tif ( this.imageCount === 0 ) {\n\t\t\treturn {\n\t\t\t\tscore: this._config.scores.noImages,\n\t\t\t\tresultText: i18n.sprintf(\n\t\t\t\t\t/* Translators: %1$s and %2$s expand to links on yoast.com, %3$s expands to the anchor end tag */\n\t\t\t\t\ti18n.dgettext(\n\t\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\t\"%1$sImage alt attributes%3$s: No images appear on this page. %2$sAdd some%3$s!\"\n\t\t\t\t\t),\n\t\t\t\t\tthis._config.urlTitle,\n\t\t\t\t\tthis._config.urlCallToAction,\n\t\t\t\t\t\"</a>\"\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\n\t\t// Has alt-tags, but no keyword is set.\n\t\tif ( this.altProperties.withAlt > 0 ) {\n\t\t\treturn {\n\t\t\t\tscore: this._config.scores.withAlt,\n\t\t\t\tresultText: i18n.sprintf(\n\t\t\t\t\t/* Translators: %1$s and %2$s expand to links on yoast.com, %3$s expands to the anchor end tag */\n\t\t\t\t\ti18n.dgettext(\n\t\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\t\"%1$sImage alt attributes%3$s: \" +\n\t\t\t\t\t\t\"Images on this page have alt attributes, but you have not set your keyphrase. %2$sFix that%3$s!\"\n\t\t\t\t\t),\n\t\t\t\t\tthis._config.urlTitle,\n\t\t\t\t\tthis._config.urlCallToAction,\n\t\t\t\t\t\"</a>\"\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\n\t\t// Has alt-tags, but no keywords while a keyword is set.\n\t\tif ( this.altProperties.withAltNonKeyword > 0 && this.altProperties.withAltKeyword === 0 ) {\n\t\t\treturn {\n\t\t\t\tscore: this._config.scores.withAltNonKeyword,\n\t\t\t\tresultText: i18n.sprintf(\n\t\t\t\t\t/* Translators: %1$s and %2$s expand to links on yoast.com, %3$s expands to the anchor end tag */\n\t\t\t\t\ti18n.dgettext(\n\t\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\t\"%1$sImage alt attributes%3$s: \" +\n\t\t\t\t\t\t\"Images on this page do not have alt attributes that reflect the topic of your text. \" +\n\t\t\t\t\t\t\"%2$sAdd your keyphrase or synonyms to the alt tags of relevant images%3$s!\"\n\t\t\t\t\t),\n\t\t\t\t\tthis._config.urlTitle,\n\t\t\t\t\tthis._config.urlCallToAction,\n\t\t\t\t\t\"</a>\"\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\n\t\t// Image count ≥5, has alt-tags with too few keywords.\n\t\tif ( this.hasTooFewMatches() ) {\n\t\t\treturn {\n\t\t\t\tscore: this._config.scores.withAltTooFewKeywordMatches,\n\t\t\t\tresultText: i18n.sprintf(\n\t\t\t\t\t/* Translators: %1$d expands to the number of images containing an alt attribute with the keyword,\n\t\t\t\t\t * %2$d expands to the total number of images, %3$s and %4$s expand to links on yoast.com,\n\t\t\t\t\t * %5$s expands to the anchor end tag. */\n\t\t\t\t\ti18n.dngettext(\n\t\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\t\"%3$sImage alt attributes%5$s: Out of %2$d images on this page, only %1$d has an alt attribute that \" +\n\t\t\t\t\t\t\"reflects the topic of your text. \" +\n\t\t\t\t\t\t\"%4$sAdd your keyphrase or synonyms to the alt tags of more relevant images%5$s!\",\n\t\t\t\t\t\t\"%3$sImage alt attributes%5$s: Out of %2$d images on this page, only %1$d have alt attributes that \" +\n\t\t\t\t\t\t\"reflect the topic of your text. \" +\n\t\t\t\t\t\t\"%4$sAdd your keyphrase or synonyms to the alt tags of more relevant images%5$s!\",\n\t\t\t\t\t\tthis.altProperties.withAltKeyword,\n\t\t\t\t\t),\n\t\t\t\t\tthis.altProperties.withAltKeyword,\n\t\t\t\t\tthis.imageCount,\n\t\t\t\t\tthis._config.urlTitle,\n\t\t\t\t\tthis._config.urlCallToAction,\n\t\t\t\t\t\"</a>\"\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\n\t\t/*\n\t\t * The hasGoodNumberOfMatches check needs to be made before the check for too many matches because of the special rule for\n\t\t * exactly 5 matches.\n\t\t */\n\t\tif ( this.hasGoodNumberOfMatches() ) {\n\t\t\treturn {\n\t\t\t\tscore: this._config.scores.withAltGoodNumberOfKeywordMatches,\n\t\t\t\tresultText: i18n.sprintf(\n\t\t\t\t\t/* Translators: %1$s expands to a link on yoast.com,\n\t\t\t\t\t * %2$s expands to the anchor end tag. */\n\t\t\t\t\ti18n.dgettext(\n\t\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\t\"%1$sImage alt attributes%2$s: Good job!\",\n\t\t\t\t\t),\n\t\t\t\t\tthis._config.urlTitle,\n\t\t\t\t\t\"</a>\"\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\n\t\tif ( this.hasTooManyMatches() ) {\n\t\t\treturn {\n\t\t\t\tscore: this._config.scores.withAltTooManyKeywordMatches,\n\t\t\t\tresultText: i18n.sprintf(\n\t\t\t\t\t/* Translators: %1$d expands to the number of images containing an alt attribute with the keyword,\n                     * %2$d expands to the total number of images, %3$s and %4$s expand to a link on yoast.com,\n\t\t\t\t\t * %5$s expands to the anchor end tag. */\n\t\t\t\t\ti18n.dgettext(\n\t\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\t\"%3$sImage alt attributes%5$s: Out of %2$d images on this page, %1$d have alt attributes with \" +\n\t\t\t\t\t\t\"words from your keyphrase or synonyms. \" +\n\t\t\t\t\t\t\"That's a bit much. %4$sOnly include the keyphrase or its synonyms when it really fits the image%5$s.\",\n\t\t\t\t\t),\n\t\t\t\t\tthis.altProperties.withAltKeyword,\n\t\t\t\t\tthis.imageCount,\n\t\t\t\t\tthis._config.urlTitle,\n\t\t\t\t\tthis._config.urlCallToAction,\n\t\t\t\t\t\"</a>\"\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\n\t\t// Images, but no alt tags.\n\t\treturn {\n\t\t\tscore: this._config.scores.noAlt,\n\t\t\tresultText: i18n.sprintf(\n\t\t\t\t/* Translators: %1$s and %2$s expand to links on yoast.com, %3$s expands to the anchor end tag */\n\t\t\t\ti18n.dgettext( \"js-text-analysis\", \"%1$sImage alt attributes%3$s: \" +\n\t\t\t\t\t\"Images on this page do not have alt attributes that reflect the topic of your text. \" +\n\t\t\t\t\t\"%2$sAdd your keyphrase or synonyms to the alt tags of relevant images%3$s!\" ),\n\t\t\t\tthis._config.urlTitle,\n\t\t\t\tthis._config.urlCallToAction,\n\t\t\t\t\"</a>\"\n\t\t\t),\n\t\t};\n\t}\n}\n"]}