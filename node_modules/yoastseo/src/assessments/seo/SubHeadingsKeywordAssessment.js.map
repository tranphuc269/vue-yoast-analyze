{"version":3,"sources":["../../../../src/assessments/seo/SubHeadingsKeywordAssessment.js"],"names":["SubHeadingsKeywordAssessment","Assessment","constructor","config","defaultConfig","parameters","lowerBoundary","upperBoundary","scores","noMatches","tooFewMatches","goodNumberOfMatches","tooManyMatches","urlTitle","urlCallToAction","identifier","_config","getResult","paper","researcher","i18n","_subHeadings","getResearch","assessmentResult","AssessmentResult","_minNumberOfSubheadings","Math","ceil","count","_maxNumberOfSubheadings","floor","calculatedResult","calculateResult","setScore","score","setText","resultText","hasSubheadings","subheadings","getText","length","isApplicable","hasText","hasKeyword","hasTooFewMatches","matches","hasTooManyMatches","isOneOfOne","hasGoodNumberOfMatches","sprintf","dgettext","dngettext"],"mappings":";;;;;;AAAA;;AAEA;;;;AACA;;AACA;;AACA;;AACA;;;;;;AAEA;;;AAGe,MAAMA,4BAAN,SAA2CC,oBAA3C,CAAsD;AACpE;;;;;;;AAOAC,aAAaC,SAAS,EAAtB,EAA2B;AAC1B;;AAEA,QAAMC,gBAAgB;AACrBC,eAAY;AACXC,mBAAe,GADJ;AAEXC,mBAAe;AAFJ,IADS;AAKrBC,WAAQ;AACPC,eAAW,CADJ;AAEPC,mBAAe,CAFR;AAGPC,yBAAqB,CAHd;AAIPC,oBAAgB;AAJT,IALa;AAWrBC,aAAU,yCAAwB,oBAAxB,CAXW;AAYrBC,oBAAiB,yCAAwB,oBAAxB;AAZI,GAAtB;;AAeA,OAAKC,UAAL,GAAkB,oBAAlB;AACA,OAAKC,OAAL,GAAe,qBAAOZ,aAAP,EAAsBD,MAAtB,CAAf;AACA;;AAED;;;;;;;;;AASAc,WAAWC,KAAX,EAAkBC,UAAlB,EAA8BC,IAA9B,EAAqC;AACpC,OAAKC,YAAL,GAAoBF,WAAWG,WAAX,CAAwB,2BAAxB,CAApB;;AAEA,QAAMC,mBAAmB,IAAIC,0BAAJ,EAAzB;;AAEA,OAAKC,uBAAL,GAA+BC,KAAKC,IAAL,CAAW,KAAKN,YAAL,CAAkBO,KAAlB,GAA0B,KAAKZ,OAAL,CAAaX,UAAb,CAAwBC,aAA7D,CAA/B;AACA,OAAKuB,uBAAL,GAA+BH,KAAKI,KAAL,CAAY,KAAKT,YAAL,CAAkBO,KAAlB,GAA0B,KAAKZ,OAAL,CAAaX,UAAb,CAAwBE,aAA9D,CAA/B;AACA,QAAMwB,mBAAmB,KAAKC,eAAL,CAAsBZ,IAAtB,CAAzB;;AAEAG,mBAAiBU,QAAjB,CAA2BF,iBAAiBG,KAA5C;AACAX,mBAAiBY,OAAjB,CAA0BJ,iBAAiBK,UAA3C;;AAEA,SAAOb,gBAAP;AACA;;AAED;;;;;;;AAOAc,gBAAgBnB,KAAhB,EAAwB;AACvB,QAAMoB,cAAe,4CAAwBpB,MAAMqB,OAAN,EAAxB,CAArB;AACA,SAAOD,YAAYE,MAAZ,GAAqB,CAA5B;AACA;;AAED;;;;;;;AAOAC,cAAcvB,KAAd,EAAsB;AACrB,SAAOA,MAAMwB,OAAN,MAAmBxB,MAAMyB,UAAN,EAAnB,IAAyC,KAAKN,cAAL,CAAqBnB,KAArB,CAAhD;AACA;;AAED;;;;;;;;AAQA0B,oBAAmB;AAClB,SAAO,KAAKvB,YAAL,CAAkBwB,OAAlB,GAA4B,CAA5B,IAAiC,KAAKxB,YAAL,CAAkBwB,OAAlB,GAA4B,KAAKpB,uBAAzE;AACA;;AAED;;;;;;;;;AASAqB,qBAAoB;AACnB,SAAO,KAAKzB,YAAL,CAAkBO,KAAlB,GAA0B,CAA1B,IAA+B,KAAKP,YAAL,CAAkBwB,OAAlB,GAA4B,KAAKhB,uBAAvE;AACA;;AAED;;;;;;AAMAkB,cAAa;AACZ,SAAO,KAAK1B,YAAL,CAAkBO,KAAlB,KAA4B,CAA5B,IAAiC,KAAKP,YAAL,CAAkBwB,OAAlB,KAA8B,CAAtE;AACA;;AAED;;;;;;;;AAQAG,0BAAyB;AACxB,SAAO,uCACN,KAAK3B,YAAL,CAAkBwB,OADZ,EAEN,KAAKpB,uBAFC,EAGN,KAAKI,uBAHC,CAAP;AAKA;;AAED;;;;;;;AAOAG,iBAAiBZ,IAAjB,EAAwB;AACvB,MAAK,KAAKwB,gBAAL,EAAL,EAA+B;AAC9B,UAAO;AACNV,WAAO,KAAKlB,OAAL,CAAaR,MAAb,CAAoBE,aADrB;AAEN0B,gBAAYhB,KAAK6B,OAAL;AACX;AACA7B,SAAK8B,QAAL,CACC,kBADD,EAEC,yGAFD,CAFW,EAMX,KAAKlC,OAAL,CAAaH,QANF,EAOX,KAAKG,OAAL,CAAaF,eAPF,EAQX,MARW;AAFN,IAAP;AAaA;;AAED,MAAK,KAAKgC,iBAAL,EAAL,EAAgC;AAC/B,UAAO;AACNZ,WAAO,KAAKlB,OAAL,CAAaR,MAAb,CAAoBI,cADrB;AAENwB,gBAAYhB,KAAK6B,OAAL;AACX;AACA7B,SAAK8B,QAAL,CACC,kBADD,EAEC,mHACA,+CAHD,CAFW,EAOX,KAAKlC,OAAL,CAAaH,QAPF,EAQX,KAAKG,OAAL,CAAaF,eARF,EASX,MATW;AAFN,IAAP;AAcA;;AAED,MAAK,KAAKiC,UAAL,EAAL,EAAyB;AACxB,UAAO;AACNb,WAAO,KAAKlB,OAAL,CAAaR,MAAb,CAAoBG,mBADrB;AAENyB,gBAAYhB,KAAK6B,OAAL;AACX;;AAEA7B,SAAK8B,QAAL,CACC,kBADD,EAEC,sGAFD,EAGC,KAAK7B,YAAL,CAAkBwB,OAHnB,CAHW,EAQX,KAAK7B,OAAL,CAAaH,QARF,EASX,MATW;AAFN,IAAP;AAcA;;AAED,MAAK,KAAKmC,sBAAL,EAAL,EAAqC;AACpC,UAAO;AACNd,WAAO,KAAKlB,OAAL,CAAaR,MAAb,CAAoBG,mBADrB;AAENyB,gBAAYhB,KAAK6B,OAAL;AACX;;AAEA7B,SAAK+B,SAAL,CACC,kBADD,EAEC,gHAFD,EAGC,+GAHD,EAIC,KAAK9B,YAAL,CAAkBwB,OAJnB,CAHW,EASX,KAAK7B,OAAL,CAAaH,QATF,EAUX,MAVW,EAWX,KAAKQ,YAAL,CAAkBwB,OAXP;AAFN,IAAP;AAgBA;;AAED,SAAO;AACNX,UAAO,KAAKlB,OAAL,CAAaR,MAAb,CAAoBC,SADrB;AAEN2B,eAAYhB,KAAK6B,OAAL;AACX;AACA7B,QAAK8B,QAAL,CACC,kBADD,EAEC,yGAFD,CAFW,EAMX,KAAKlC,OAAL,CAAaH,QANF,EAOX,KAAKG,OAAL,CAAaF,eAPF,EAQX,MARW;AAFN,GAAP;AAaA;AA1NmE;kBAAhDd,4B","file":"SubHeadingsKeywordAssessment.js","sourcesContent":["import { merge } from \"lodash-es\";\n\nimport Assessment from \"../../assessment\";\nimport { createAnchorOpeningTag } from \"../../helpers/shortlinker\";\nimport { inRangeStartEndInclusive } from \"../../helpers/inRange.js\";\nimport { getSubheadingsTopLevel } from \"../../stringProcessing/getSubheadings\";\nimport AssessmentResult from \"../../values/AssessmentResult\";\n\n/**\n * Represents the assessment that checks if the keyword is present in one of the subheadings.\n */\nexport default class SubHeadingsKeywordAssessment extends Assessment {\n\t/**\n\t * Sets the identifier and the config.\n\t *\n\t * @param {object} config The configuration to use.\n\t *\n\t * @returns {void}\n\t */\n\tconstructor( config = {} ) {\n\t\tsuper();\n\n\t\tconst defaultConfig = {\n\t\t\tparameters: {\n\t\t\t\tlowerBoundary: 0.3,\n\t\t\t\tupperBoundary: 0.75,\n\t\t\t},\n\t\t\tscores: {\n\t\t\t\tnoMatches: 3,\n\t\t\t\ttooFewMatches: 3,\n\t\t\t\tgoodNumberOfMatches: 9,\n\t\t\t\ttooManyMatches: 3,\n\t\t\t},\n\t\t\turlTitle: createAnchorOpeningTag( \"https://yoa.st/33m\" ),\n\t\t\turlCallToAction: createAnchorOpeningTag( \"https://yoa.st/33n\" ),\n\t\t};\n\n\t\tthis.identifier = \"subheadingsKeyword\";\n\t\tthis._config = merge( defaultConfig, config );\n\t}\n\n\t/**\n\t * Runs the matchKeywordInSubheadings research and based on this returns an assessment result.\n\t *\n\t * @param {Paper} paper             The paper to use for the assessment.\n\t * @param {Researcher} researcher   The researcher used for calling research.\n\t * @param {Object} i18n             The object used for translations.\n\t *\n\t * @returns {AssessmentResult} The assessment result.\n\t */\n\tgetResult( paper, researcher, i18n ) {\n\t\tthis._subHeadings = researcher.getResearch( \"matchKeywordInSubheadings\" );\n\n\t\tconst assessmentResult = new AssessmentResult();\n\n\t\tthis._minNumberOfSubheadings = Math.ceil( this._subHeadings.count * this._config.parameters.lowerBoundary );\n\t\tthis._maxNumberOfSubheadings = Math.floor( this._subHeadings.count * this._config.parameters.upperBoundary );\n\t\tconst calculatedResult = this.calculateResult( i18n );\n\n\t\tassessmentResult.setScore( calculatedResult.score );\n\t\tassessmentResult.setText( calculatedResult.resultText );\n\n\t\treturn assessmentResult;\n\t}\n\n\t/**\n\t * Checks whether the paper has a subheadings.\n\t *\n\t * @param {Paper} paper The paper to use for the check.\n\t *\n\t * @returns {boolean} True when there is at least one subheading.\n\t */\n\thasSubheadings( paper ) {\n\t\tconst subheadings =  getSubheadingsTopLevel( paper.getText() );\n\t\treturn subheadings.length > 0;\n\t}\n\n\t/**\n\t * Checks whether the paper has a text and a keyword.\n\t *\n\t * @param {Paper} paper The paper to use for the assessment.\n\t *\n\t * @returns {boolean} True when there is text and a keyword.\n\t */\n\tisApplicable( paper ) {\n\t\treturn paper.hasText() && paper.hasKeyword() && this.hasSubheadings( paper );\n\t}\n\n\t/**\n\t * Checks whether there are too few subheadings with the keyphrase.\n\t *\n\t * This is the case if the number of subheadings with the keyphrase is more than 0 but less than the specified\n\t * recommended minimum.\n\t *\n\t * @returns {boolean} Returns true if the keyphrase is included in too few subheadings.\n\t */\n\thasTooFewMatches() {\n\t\treturn this._subHeadings.matches > 0 && this._subHeadings.matches < this._minNumberOfSubheadings;\n\t}\n\n\t/**\n\t * Checks whether there are too many subheadings with the keyphrase.\n\t *\n\t * The upper limit is only applicable if there is more than one subheading. If there is only one subheading with\n\t * the keyphrase this would otherwise always lead to a 100% match rate.\n\t *\n\t * @returns {boolean} Returns true if there is more than one subheading and if the keyphrase is included in less\n\t *                    subheadings than the recommended maximum.\n\t */\n\thasTooManyMatches() {\n\t\treturn this._subHeadings.count > 1 && this._subHeadings.matches > this._maxNumberOfSubheadings;\n\t}\n\n\t/**\n\t * Checks whether there is only one higher-level subheading and this subheading includes the keyphrase.\n\t *\n\t * @returns {boolean} Returns true if there is exactly one higher-level subheading and this\n\t * subheading has a keyphrase match.\n\t */\n\tisOneOfOne() {\n\t\treturn this._subHeadings.count === 1 && this._subHeadings.matches === 1;\n\t}\n\n\t/**\n\t * Checks whether there is a good number of subheadings with the keyphrase.\n\t *\n\t * This is the case if there is only one subheading and that subheading includes the keyphrase or if the number of\n\t * subheadings with the keyphrase is within the specified recommended range.\n\t *\n\t * @returns {boolean} Returns true if the keyphrase is included in a sufficient number of subheadings.\n\t */\n\thasGoodNumberOfMatches() {\n\t\treturn inRangeStartEndInclusive(\n\t\t\tthis._subHeadings.matches,\n\t\t\tthis._minNumberOfSubheadings,\n\t\t\tthis._maxNumberOfSubheadings,\n\t\t);\n\t}\n\n\t/**\n\t * Determines the score and the Result text for the subheadings.\n\t *\n\t * @param {Object} i18n The object used for translations.\n\t *\n\t * @returns {Object} The object with the calculated score and the result text.\n\t */\n\tcalculateResult( i18n ) {\n\t\tif ( this.hasTooFewMatches() ) {\n\t\t\treturn {\n\t\t\t\tscore: this._config.scores.tooFewMatches,\n\t\t\t\tresultText: i18n.sprintf(\n\t\t\t\t\t/* Translators: %1$s and %2$s expand to a link on yoast.com, %3$s expands to the anchor end tag. */\n\t\t\t\t\ti18n.dgettext(\n\t\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\t\"%1$sKeyphrase in subheading%3$s: %2$sUse more keyphrases or synonyms in your H2 and H3 subheadings%3$s!\",\n\t\t\t\t\t),\n\t\t\t\t\tthis._config.urlTitle,\n\t\t\t\t\tthis._config.urlCallToAction,\n\t\t\t\t\t\"</a>\",\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\n\t\tif ( this.hasTooManyMatches() ) {\n\t\t\treturn {\n\t\t\t\tscore: this._config.scores.tooManyMatches,\n\t\t\t\tresultText: i18n.sprintf(\n\t\t\t\t\t/* Translators: %1$s and %2$s expand to a link on yoast.com, %3$s expands to the anchor end tag. */\n\t\t\t\t\ti18n.dgettext(\n\t\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\t\"%1$sKeyphrase in subheading%3$s: More than 75%% of your H2 and H3 subheadings reflect the topic of your copy. \" +\n\t\t\t\t\t\t\"That's too much. %2$sDon't over-optimize%3$s!\",\n\t\t\t\t\t),\n\t\t\t\t\tthis._config.urlTitle,\n\t\t\t\t\tthis._config.urlCallToAction,\n\t\t\t\t\t\"</a>\",\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\n\t\tif ( this.isOneOfOne() ) {\n\t\t\treturn {\n\t\t\t\tscore: this._config.scores.goodNumberOfMatches,\n\t\t\t\tresultText: i18n.sprintf(\n\t\t\t\t\t/* Translators: %1$s expands to a link on yoast.com, %2$s expands to the anchor end tag,\n\t\t\t\t\t%3$d expands to the number of subheadings containing the keyphrase. */\n\t\t\t\t\ti18n.dgettext(\n\t\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\t\"%1$sKeyphrase in subheading%2$s: Your H2 or H3 subheading reflects the topic of your copy. Good job!\",\n\t\t\t\t\t\tthis._subHeadings.matches,\n\t\t\t\t\t),\n\t\t\t\t\tthis._config.urlTitle,\n\t\t\t\t\t\"</a>\",\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\n\t\tif ( this.hasGoodNumberOfMatches() ) {\n\t\t\treturn {\n\t\t\t\tscore: this._config.scores.goodNumberOfMatches,\n\t\t\t\tresultText: i18n.sprintf(\n\t\t\t\t\t/* Translators: %1$s expands to a link on yoast.com, %2$s expands to the anchor end tag,\n\t\t\t\t\t%3$d expands to the number of subheadings containing the keyphrase. */\n\t\t\t\t\ti18n.dngettext(\n\t\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\t\"%1$sKeyphrase in subheading%2$s: %3$s of your H2 and H3 subheadings reflects the topic of your copy. Good job!\",\n\t\t\t\t\t\t\"%1$sKeyphrase in subheading%2$s: %3$s of your H2 and H3 subheadings reflect the topic of your copy. Good job!\",\n\t\t\t\t\t\tthis._subHeadings.matches,\n\t\t\t\t\t),\n\t\t\t\t\tthis._config.urlTitle,\n\t\t\t\t\t\"</a>\",\n\t\t\t\t\tthis._subHeadings.matches,\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tscore: this._config.scores.noMatches,\n\t\t\tresultText: i18n.sprintf(\n\t\t\t\t/* Translators: %1$s and %2$s expand to a link on yoast.com, %3$s expands to the anchor end tag. */\n\t\t\t\ti18n.dgettext(\n\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\"%1$sKeyphrase in subheading%3$s: %2$sUse more keyphrases or synonyms in your H2 and H3 subheadings%3$s!\",\n\t\t\t\t),\n\t\t\t\tthis._config.urlTitle,\n\t\t\t\tthis._config.urlCallToAction,\n\t\t\t\t\"</a>\",\n\t\t\t),\n\t\t};\n\t}\n}\n"]}